<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Material - Fibra √ìptica Online</title>
    
    <!-- Favicon con logo de empresa -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/logo.png">
    <link rel="shortcut icon" type="image/png" href="assets/logo.png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <img src="assets/logo.png" alt="Logo" class="loading-logo">
            <h2>Cargando aplicaci√≥n online...</h2>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="loading-text">Sincronizando con Firebase...</p>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div id="app" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="assets/logo.png" alt="Logo" class="logo">
                <h2>Control Fibra √ìptica</h2>
                <div class="connection-status">
                    <span class="status-indicator online" id="status-indicator">‚óè</span>
                    <span class="status-text" id="status-text">Online</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">üë§</div>
                <div class="user-details">
                    <div class="user-name" id="user-name">Usuario <button class="logout-btn" id="logout-btn" title="Cerrar Sesi√≥n">üö™</button></div>
                    <div class="user-role" id="user-role">Trabajador</div>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <a href="#dashboard" class="menu-item active" data-section="dashboard">
                    üìä Dashboard
                </a>
                <a href="#movimientos" class="menu-item" data-section="movimientos">
                    üìã Movimientos
                </a>
                <a href="#reportes" class="menu-item admin-only" data-section="reportes" style="display: none;">
                    üìà Reportes
                </a>
                <a href="#materiales" class="menu-item" data-section="materiales">
                    üì¶ Materiales
                </a>
                <a href="#configuracion" class="menu-item admin-only" data-section="configuracion" style="display: none;">
                    ‚öôÔ∏è Configuraci√≥n
                </a>
                <a href="#usuarios" class="menu-item admin-only" data-section="usuarios" style="display: none;">
                    üë• Usuarios
                </a>
                <a href="#" class="menu-item logout-menu-item" id="sidebar-logout-btn">
                    üö™ Cerrar Sesi√≥n
                </a>
            </nav>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <h1>üìä Dashboard</h1>
                    <div class="date-time" id="current-datetime"></div>
                </div>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-icon">üì¶</div>
                        <div class="card-content">
                            <h3 id="total-materials">0</h3>
                            <p>Materiales Totales</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">üìã</div>
                        <div class="card-content">
                            <h3 id="total-movements">0</h3>
                            <p>Movimientos Hoy</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">‚ö†Ô∏è</div>
                        <div class="card-content">
                            <h3 id="low-stock">0</h3>
                            <p>Stock Bajo</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card admin-only">
                        <div class="card-icon">üë•</div>
                        <div class="card-content">
                            <h3 id="active-workers">0</h3>
                            <p>Trabajadores Activos</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Movimientos -->
            <section id="movimientos" class="section">
                <div class="section-header">
                    <h1>üìã Registro de Movimientos</h1>
                    <button class="btn btn-primary" id="new-movement-btn">‚ûï Nuevo Movimiento</button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="movement-search" placeholder="üîç Buscar movimientos...">
                    <select id="movement-filter">
                        <option value="">Todos los tipos</option>
                        <option value="entrada">Entrada</option>
                        <option value="salida">Salida</option>
                        <option value="ajuste">Ajuste</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table id="movements-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Material</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Usuario</th>
                                <th>Observaciones</th>
                            </tr>
                        </thead>
                        <tbody id="movements-tbody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Reportes -->
            <section id="reportes" class="section">
                <div class="section-header">
                    <h1>üìà Reportes</h1>
                    <div class="report-controls">
                        <select id="report-type">
                            <option value="movements">Reporte de Movimientos</option>
                            <option value="materials">Estado de Materiales</option>
                            <option value="workers">Rendimiento de Trabajadores</option>
                        </select>
                        <input type="date" id="report-start-date">
                        <input type="date" id="report-end-date">
                        <button class="btn btn-primary" id="generate-report-btn">üìä Generar Reporte</button>
                    </div>
                </div>
                
                <div class="report-content" id="report-content">
                    <div class="report-placeholder">
                        <p>Selecciona las opciones de reporte y haz clic en "Generar Reporte"</p>
                    </div>
                </div>
                
                <div class="report-actions" id="report-actions" style="display: none;">
                    <button class="btn btn-primary" id="print-report-btn">üñ®Ô∏è Imprimir / Guardar como PDF</button>
                    <button class="btn btn-secondary" id="download-pdf-btn">üìÑ Descargar PDF</button>
                </div>
            </section>

            <!-- Materiales -->
            <section id="materiales" class="section">
                <div class="section-header">
                    <h1>üì¶ Gesti√≥n de Materiales</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="export-materials-pdf-btn">üìÑ Descargar PDF</button>
                        <!-- NUEVA FUNCIONALIDAD: Bot√≥n para agregar material (solo admin) -->
                        <button class="btn btn-primary admin-only" id="new-material-btn" style="display: none;">‚ûï Nuevo Material</button>
                    </div>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="material-search" placeholder="üîç Buscar materiales...">
                    <select id="category-filter">
                        <option value="">Todas las categor√≠as</option>
                        <option value="cables">Cable</option>
                        <option value="conectores">Conectores</option>
                        <option value="repartidores">Repartidores</option>
                        <option value="herramientas">Herramientas</option>
                        <option value="equipos">Equipos</option>
                        <option value="menudo">Material Menudo</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table id="materials-table">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nombre</th>
                                <th>Categor√≠a</th>
                                <th>Stock</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="materials-tbody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Configuraci√≥n -->
            <section id="configuracion" class="section">
                <div class="section-header">
                    <h1>‚öôÔ∏è Configuraci√≥n</h1>
                </div>
                
                <div class="config-sections">
                    <div class="config-section">
                        <h3>‚öôÔ∏è Configuraci√≥n General</h3>
                        <form id="settings-form">
                            <div class="form-group">
                                <label for="company-name">Nombre de la Empresa:</label>
                                <input type="text" id="company-name" name="companyName">
                            </div>
                            
                            <div class="form-group">
                                <label for="notification-threshold">Umbral de Alertas (%):</label>
                                <input type="number" id="notification-threshold" name="notificationThreshold" min="1" max="50">
                            </div>
                            
                            <div class="form-group">
                                <label for="auto-backup">Backup Autom√°tico:</label>
                                <select id="auto-backup" name="autoBackup">
                                    <option value="true">Activado</option>
                                    <option value="false">Desactivado</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üíæ Guardar Configuraci√≥n</button>
                        </form>
                    </div>
                    
                    <div class="config-section">
                        <h3>üìä Datos y Control</h3>
                        <!-- NUEVAS FUNCIONALIDADES AGREGADAS -->
                        <div class="data-actions">
                            <!-- Bot√≥n Vaciar Stock (solo admin) -->
                            <button class="btn btn-danger admin-only" id="empty-stock-btn" style="display: none;">
                                üóëÔ∏è Vaciar Stock
                            </button>
                            
                            <!-- Bot√≥n Limpiar Base de Datos Firebase (solo admin) -->
                            <button class="btn btn-danger admin-only" id="clear-firebase-btn" style="display: none;">
                                üî• Limpiar Base de Datos Firebase
                            </button>
                            
                            <!-- Bot√≥n Crear Backup (solo admin) -->
                            <button class="btn btn-primary admin-only" id="create-backup-btn" style="display: none;">
                                üíæ Crear Backup
                            </button>
                            
                            <!-- Bot√≥n Restaurar Backup (solo admin) -->
                            <button class="btn btn-warning admin-only" id="restore-backup-btn" style="display: none;">
                                üìÇ Restaurar Backup
                            </button>
                            
                            <!-- Opciones existentes -->
                            <button class="btn btn-secondary" id="export-excel-btn">üìä Descargar Excel</button>
                            <button class="btn btn-secondary" id="export-pdf-btn">üìÑ Descargar PDF</button>
                            <button class="btn btn-secondary" id="export-data-btn">üì• Exportar JSON</button>
                            <button class="btn btn-secondary" id="import-data-btn">üì§ Importar Datos</button>
                            
                            <!-- Bot√≥n Limpiar Solo Movimientos (solo admin) -->
                            <button class="btn btn-warning admin-only" id="clear-data-btn" style="display: none;">
                                üßπ Limpiar Movimientos
                            </button>
                            
                            <!-- Bot√≥n Limpiar TODOS los Datos (solo admin) -->
                            <button class="btn btn-danger admin-only" id="clear-all-data-btn" style="display: none;">
                                üßπ Limpiar TODOS los Datos
                            </button>
                            
                            <!-- Botones de Diagn√≥stico (solo admin) -->
                            <button class="btn btn-info admin-only" id="diagnose-data-btn" style="display: none;">
                                üîç Diagnosticar Datos
                            </button>
                            <button class="btn btn-success admin-only" id="restore-materials-btn" style="display: none;">
                                üîÑ Restaurar Materiales B√°sicos
                            </button>
                        </div>
                        
                        <!-- Nota sobre funcionalidades de admin -->
                        <div class="admin-note">
                            <p><strong>Nota:</strong> Las funciones de backup, restauraci√≥n y limpieza de datos est√°n disponibles solo para administradores.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Usuarios -->
            <section id="usuarios" class="section">
                <div class="section-header">
                    <h1>üë• Gesti√≥n de Usuarios</h1>
                    <button class="btn btn-primary admin-only" id="add-user-btn">‚ûï Nuevo Usuario</button>
                </div>
                
                <div class="table-container">
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Rol</th>
                                <th>Activo</th>
                                <th>Contrase√±a</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal de Login -->
    <div id="login-modal" class="modal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h2>üîê Acceso al Sistema</h2>
                <div class="modal-subtitle">
                    <p>Sistema de Control de Stock - Fibra √ìptica</p>
                    <div class="firebase-status">
                        <span class="status-indicator online">‚óè</span>
                        <span>Online - Sincronizado</span>
                    </div>
                </div>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="worker-select">Selecciona tu nombre:</label>
                    <select id="worker-select" required>
                        <option value="">-- Selecciona tu nombre --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="login-password">Contrase√±a:</label>
                    <input type="password" id="login-password" placeholder="Ingresa tu contrase√±a" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">üöÄ Ingresar</button>
            </form>
            <div class="login-footer">
                <button type="button" class="btn btn-secondary btn-full" id="admin-login-btn">üë®‚Äçüíº Acceso Administrador</button>
            </div>
        </div>
    </div>

    <!-- Modal de Login de Administrador -->
    <div id="admin-login-modal" class="modal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h2>üë®‚Äçüíº Acceso Administrador</h2>
                <div class="modal-subtitle">
                    <p>Panel de Administraci√≥n</p>
                    <div class="firebase-status">
                        <span class="status-indicator online">‚óè</span>
                        <span>Online - Sincronizado</span>
                    </div>
                </div>
            </div>
            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-select">Selecciona tu nombre:</label>
                    <select id="admin-select" required>
                        <option value="">-- Selecciona tu nombre --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="admin-password">Contrase√±a:</label>
                    <input type="password" id="admin-password" placeholder="Ingresa tu contrase√±a" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">üöÄ Ingresar como Admin</button>
            </form>
            <div class="login-footer">
                <button type="button" class="btn btn-secondary btn-full modal-cancel">üîô Volver al Login</button>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Movimiento -->
    <div id="movement-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nuevo Movimiento</h2>
                <span class="close">&times;</span>
            </div>
            <form id="movement-form">
                <div class="form-group">
                    <label for="movement-material">Material:</label>
                    <select id="movement-material" required>
                        <option value="">-- Selecciona un material --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="movement-type">Tipo de Movimiento:</label>
                    <select id="movement-type" required>
                        <option value="">-- Selecciona el tipo --</option>
                        <option value="entrada">üì¶ Entrada</option>
                        <option value="salida">üì§ Salida</option>
                        <option value="ajuste">‚öñÔ∏è Ajuste</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="movement-quantity">Cantidad:</label>
                    <input type="number" id="movement-quantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="movement-observations">Observaciones:</label>
                    <textarea id="movement-observations" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancel-movement-btn" class="btn btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Guardar Movimiento</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Estilos adicionales para las nuevas funcionalidades -->
    <style>
        /* Estilos para indicadores de estado */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .status-indicator {
            font-size: 8px;
        }

        .status-indicator.online {
            color: #10b981;
        }

        .status-indicator.offline {
            color: #ef4444;
        }

        .firebase-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #10b981;
            margin-top: 8px;
        }

        .modal-subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 16px;
        }

        .modal-subtitle p {
            margin: 0;
            font-size: 14px;
        }

        /* Estilos para botones admin */
        .admin-only {
            /* Los estilos se manejan din√°micamente en JavaScript */
        }

        .admin-note {
            margin-top: 16px;
            padding: 12px;
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            color: #92400e;
            font-size: 14px;
        }

        /* Estilos para notificaciones */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            font-size: 14px;
        }

        /* Mejoras en el dise√±o responsive */
        @media (max-width: 768px) {
            .connection-status {
                font-size: 11px;
            }
            
            .firebase-status {
                font-size: 11px;
            }
            
            .section-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .section-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>

    <!-- Scripts de la aplicaci√≥n -->
    <script src="firebase-config.js"></script>
    <script src="firebase-storage.js"></script>
    <script src="firebase-app.js"></script>
    
    <!-- Inicializaci√≥n de la aplicaci√≥n -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, inicializando aplicaci√≥n online...');
            new FibraOpticaApp();
        });
    </script>
</body>
</html>